FROM influxdb:2.7-alpine

# Add health check script
RUN echo '#!/bin/sh\n\
wget -q --spider http://localhost:8086/health || exit 1\n\
' > /health.sh && chmod +x /health.sh

HEALTHCHECK --interval=30s --timeout=3s --start-period=40s --retries=3 \
  CMD ["/health.sh"]

EXPOSE 8086

CMD ["influxd"]
